<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="img/favicon.ico.gif">
    <title>Expanse Proxy</title>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bignumber.min.js"></script>
    <script type="text/javascript" src="js/web3-light.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header clearfix">
            <nav class="navbar navbar-inverse">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <h3 class="text-muted"><img src="img/exp.png" height="42" width="38"> Expanse Proxy</h3>
                    </div>
                    <div>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="/"><span class="glyphicon glyphicon-home"></span> Home</a></li>
                            <li><a href="/settings.html"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>
                            <li><a href="/server.html"><span class="glyphicon glyphicon-dashboard"></span> Upstream</a></li>
                            <li class="active"><a href="/stats.html"><span class="glyphicon glyphicon-stats"></span> Stats</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
        <div id="alert" class="alert alert-danger hide" role="alert">
            <strong>An error occured while polling proxy state.</strong> Make sure proxy is running.
        </div>
        <br>
        <div class="col-md-2 text-center" style="width:25%;">
            <div class="panel panel-info">
                <div data-toggle="tooltip" data-placement="top" title="NetWork Hashrate" class="panel-heading">
                    <h3 class="panel-title">Hashrate</h3>
                </div>
                <div class="panel-body">
                    <h4 id="getHashrate"></h4>
                </div>
            </div>
        </div>
        <div class="col-md-2 text-center" style="width:25%;">
            <div class="panel panel-primary">
                <div data-toggle="tooltip" data-placement="top" title="Current Difficulty" class="panel-heading">
                    <h3 class="panel-title">Difficulty</h3>
                </div>
                <div class="panel-body">
                    <h4 id="difficulty"></h4>
                </div>
            </div>
        </div>
        <div class="col-md-2 text-center" style="width:25%;">
            <div class="panel panel-warning">
                <div data-toggle="tooltip" data-placement="top" title="Last Block Number" class="panel-heading">
                    <h3 class="panel-title">Last Block</h3>
                </div>
                <div class="panel-body">
                    <h4 id="latestBlock"></h4>
                </div>
            </div>
        </div>
        <div class="col-md-2 text-center" style="width:25%;">
            <div class="panel panel-success">
                <div data-toggle="tooltip" data-placement="top" title="Time Since Latest Block" class="panel-heading">
                    <h3 class="panel-title">Last Block Time</h3>
                </div>
                <div class="panel-body">
                    <h4 id="latestBlockTimestamp"></h4>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="panel panel-default">
          <div class="panel-heading text-center"><b>Block Stats </b><span class="glyphicon glyphicon-th-large"></span></div>
          <div class="panel-body text-center">
            <h5>Latest Block Hash: <strong id="latestBlockHash"></strong></h5>
            <h5>Parent Block Hash: <strong id="parentHash"></strong></h5>
            <h5>State Root: <strong id="stateRoot"></strong></h5>
            <h5>Latest Block Miner: <strong id="miner"></strong></h5>
            <h5>Nonce: <strong id="nonce"></strong></h5>
            <h5>Gas Limit: <strong id="gasLimit"></strong></h5>
            <h5>Gas Used: <strong id="gasUsed"></strong></h5>
            <h5>Size: <strong id="size"></strong></h5>
            <h5>Extra Data: <strong id="extraData"></strong></h5>
          </div>
        </div>
        <div class="clearfix"></div>
        <div class="panel panel-default">
          <div class="panel-heading text-center"><b>Price </b><span class="glyphicon glyphicon-btc"></span></div>
          <div class="panel-body text-center">
            <h5>BTC/EXP: <strong id="BTC"></strong></h5>
            <h5>USD/EXP: <strong id="USD"></strong></h5>
          </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <p class="text-muted text-center">Please donate to <a href="https://github.com/sammy007" target="_blank"><b>sammy007</b></a> for the work on this project ETH: <code>0xb85150eb365e7df0941f0cf08235f987ba91506a</code></p>
        </div>
    </footer>
    <script type="text/javascript">
        web3.setProvider(new web3.providers.HttpProvider('http://127.0.0.1:9656'));

        btc_exp = null;
        usd_btc = null;
        expPrice = null;
        var hashrate = web3.eth.hashrate;

        web3.eth.getBlock('latest', function(error, result) {
            if (!error) {
                document.getElementById('difficulty').innerHTML = (result.difficulty / 1000000000000).toFixed(2) + ' TH';
                document.getElementById('latestBlock').innerHTML = result.number;
                var time = new Date().getTime() / 1000;
                var diff = Math.floor(time - result.timestamp);
                if (diff < 60) {
                    document.getElementById('latestBlockTimestamp').innerHTML = Math.round(diff) + ' seconds ago';
                } else
                    document.getElementById('latestBlockTimestamp').innerHTML = moment.duration(Math.round(diff), 's').humanize() + ' ago';
                document.getElementById('gasLimit').innerHTML = result.gasLimit;
                document.getElementById('gasUsed').innerHTML = result.gasUsed;
                document.getElementById('latestBlockHash').innerHTML = '<a href=\'http://www.expanse.tech/explorer/block/'+ result.hash +'\'>'+ result.hash +'</a>';
                document.getElementById('parentHash').innerHTML = '<a href=\'http://www.expanse.tech/explorer/block/'+ result.parentHash +'\'>'+ result.parentHash +'</a>';
                document.getElementById('size').innerHTML = result.size;
                document.getElementById('extraData').innerHTML = result.extraData;
                document.getElementById('miner').innerHTML = '<a href=\'http://www.expanse.tech/explorer/account/'+ result.miner +'\'>'+ result.miner +'</a>';
                document.getElementById('nonce').innerHTML = result.nonce;
                document.getElementById('stateRoot').innerHTML = result.stateRoot;
                console.log(result);
            } else
                console.error(error);
        });

        document.getElementById('getHashrate').innerHTML = (hashrate / 100000000000000000).toFixed(2) + ' GH/s';

        $.getJSON("https://poloniex.com/public?command=returnTicker").done(function(data) {
            btc_exp = data["BTC_EXP"]["last"];
            usd_btc = data["USDT_BTC"]["last"];
            expPrice = btc_exp * usd_btc;
            document.getElementById('BTC').innerHTML = btc_exp;
            document.getElementById('USD').innerHTML = '$' + expPrice.toFixed(8);
        });

        $(function() {
            $('[data-toggle="tooltip"]').tooltip()
        });
    </script>
</body>
</html>
